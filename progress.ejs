<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <% layout('layouts/boilerplate') %>
        <h1>Progress</h1>

        <div>
            <canvas id="myChart"></canvas>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const data = <%- JSON.stringify(exerciseLog) %>;
            console.log('Received data:', data); // Print received data

            //Retriving calories from data
            const calories = data.map(log => log.calories);
            //console.log(calories);

            const duration = data.map(log => log.duration);
            //console.log(duration);

            const date = data.map(log => log.date.substring(0, 10));
            //console.log(date);


            const startDate = new Date();
            startDate.setDate(startDate.getDate() - startDate.getDay());
            startDate.setHours(0, 0, 0, 0);
            startDate.toISOString();
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6);
            // console.log(startDate);
            // console.log(endDate);

            const datearr = [];
            const caloriesarr = [];
            const durationarr = [];

            for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
                const logDate = data.find(log => log.date.substring(0, 10) === date.toISOString().substring(0, 10));
                // console.log(logDate);
                if (logDate) {
                    datearr.push(date.toISOString().substring(0, 10));
                    caloriesarr.push(logDate.calories);
                    durationarr.push(logDate.duration);
                } else {
                    datearr.push(date.toISOString().substring(0, 10));
                    caloriesarr.push(0);
                    durationarr.push(0);
                }
            }
            // console.log(datearr);
            // console.log(caloriesarr);
            // console.log(durationarr);





            const ctx = document.getElementById('myChart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: datearr,
                    datasets: [{
                        label: '# of Calories Burned(Week)',
                        data: caloriesarr,
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });</script>
</body>

</html>
